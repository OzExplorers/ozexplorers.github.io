<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
  <channel>
    <title>{{ site.title | xml_escape }}</title>
    <description>{{ site.description | xml_escape }}</description>
    <link>{{ site.url | xml_escape }}</link>
    <lastBuildDate>{{ site.time | date_to_rfc822 }}</lastBuildDate>
    <pubDate>{{ site.time | date_to_rfc822 }}</pubDate>
    <ttl>1800</ttl>

    {% for post in site.posts %}
    <item>
      <title>{{ post.title | xml_escape }}</title>
      <link>{{ site.url }}{{ post.url }}</link>
      <guid>{{ site.url }}{{ post.id }}</guid>
      <pubDate>{{ post.date | date_to_rfc822 }}</pubDate>

      <!-- Custom: Add excerpt image -->
      {% if post.excerpt_image %}
      <enclosure url="{{ post.excerpt_image | prepend: site.url }}" length="0" type="image/jpeg"/>
      {% endif %}

      <!-- Custom: Call the excerpt generation include file -->
      <description>
        <![CDATA[
        {% include functions/get_article_excerpt.html
          params.article=post.content
          params.lang=post.lang
          params.excerpt_size=100 %}
        {{ return | default: "No excerpt available." }}
        <a href="{{ site.url }}{{ post.url }}">Read more</a>
        ]]>
      </description>

      <!-- Ensure summary is not blank -->
      <summary>
        {{ return | strip_html | truncate: 150 | default: post.title }}
      </summary>

    </item>
    {% endfor %}
  </channel>
</rss>
